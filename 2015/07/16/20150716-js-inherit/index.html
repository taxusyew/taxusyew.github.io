
<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Taxus">
    <title>JavaScript 继承 - Taxus</title>
    <meta name="author" content="Taxus">
    
    
    
    <meta name="description" content="原型继承原型继承有很多坑，我尽量在下面多总结一些，但是并不能保证面面俱到。而且列举的多了以后，会比较混乱，所以在最前面写出正确的方式。
12345678910111213141516171819// Vehicle - 父类function Vehicle() &amp;#123;  this.wheel = 0;  this.color = 0;  this.position = &amp;#123;x:0,">
<meta property="og:type" content="blog">
<meta property="og:title" content="JavaScript 继承">
<meta property="og:url" content="http://yoursite.com/2015/07/16/20150716-js-inherit/index.html">
<meta property="og:site_name" content="Taxus">
<meta property="og:description" content="原型继承原型继承有很多坑，我尽量在下面多总结一些，但是并不能保证面面俱到。而且列举的多了以后，会比较混乱，所以在最前面写出正确的方式。
12345678910111213141516171819// Vehicle - 父类function Vehicle() &amp;#123;  this.wheel = 0;  this.color = 0;  this.position = &amp;#123;x:0,">
<meta property="og:updated_time" content="2015-08-10T10:21:38.915Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript 继承">
<meta name="twitter:description" content="原型继承原型继承有很多坑，我尽量在下面多总结一些，但是并不能保证面面俱到。而且列举的多了以后，会比较混乱，所以在最前面写出正确的方式。
12345678910111213141516171819// Vehicle - 父类function Vehicle() &amp;#123;  this.wheel = 0;  this.color = 0;  this.position = &amp;#123;x:0,">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css" type="text/css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Taxus</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="/#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首頁</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分類</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">標籤</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">所有文章</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜尋</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">關於</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">Atom</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            JavaScript 继承
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" datetime="2015-07-16T13:57:48+09:00">
	
		    7月 16, 2015
    	
    </time>
    
</div>

</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <h1 id="原型继承">原型继承</h1><p>原型继承有很多坑，我尽量在下面多总结一些，但是并不能保证面面俱到。而且列举的多了以后，会比较混乱，所以在最前面写出正确的方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vehicle - 父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vehicle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.wheel = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">this</span>.color = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">this</span>.position = &#123;x:<span class="number">0</span>, y:<span class="number">0</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 父类方法</span></span><br><span class="line">Vehicle.prototype.move = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.position.x += x;</span><br><span class="line">  <span class="keyword">this</span>.position.y += y;</span><br><span class="line">  <span class="built_in">console</span>.info(<span class="string">'Vehicle moved.'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Car - 子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Vehicle.call(<span class="keyword">this</span>); <span class="comment">// 调用父类构造器.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类继承父类</span></span><br><span class="line">Car.prototype = <span class="built_in">Object</span>.create(Vehicle.prototype); </span><br><span class="line">Car.prototype.constructor = Car;</span><br></pre></td></tr></table></figure>
<h2 id="为什么以上正确？">为什么以上正确？</h2><h3 id="1-子类的构造器">1.子类的构造器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Car.prototype.constructor</span><br><span class="line">→ <span class="keyword">function</span> Car()</span><br></pre></td></tr></table></figure>
<p>子类构造器指向自己</p>
<h3 id="2-父类构造器">2.父类构造器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vehicle.prototype.constructor</span><br><span class="line">→ <span class="keyword">function</span> Vehicle()</span><br></pre></td></tr></table></figure>
<p>父类构造器指向自己</p>
<h3 id="3-子类是否继承父类方法">3.子类是否继承父类方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var ford = new Car()</span><br><span class="line">ford.position.x = <span class="number">3</span></span><br><span class="line">ford.position.y = <span class="number">4</span></span><br><span class="line">ford.move(<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">→ Vehicle moved.</span><br></pre></td></tr></table></figure>
<p>可以调用父类的方法</p>
<h2 id="一些疑问">一些疑问</h2><h3 id="1-为什么要Car-prototype_=_Object-create(Vehicle-prototype);而不是直接调用Car-prototype_=_Vehicle-prototype;？">1.为什么要<code>Car.prototype = Object.create(Vehicle.prototype);</code>而不是直接调用<code>Car.prototype = Vehicle.prototype;</code>？</h3><p>答： 如果设置<code>Car.prototype = Vehicle.prototype;</code>以后，再设置<code>Car.prototype.constructor = Car;</code>就会同样的修改父类的构造器指向：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vehicle.prototype.constructor</span><br><span class="line">→ <span class="keyword">function</span> Car()</span><br></pre></td></tr></table></figure></p>
<p>这样显然是有问题的。因为在用<code>Car.prototype = Vehicle.prototype;</code>直接赋值的时候，Car和Vehicle的原型引用了同一个对象，所以接下来是修改了同一个原型对象的构造器，从而造成父类构造器的改变。所以需要给子类的原型重新指向一个父类原型的深拷贝对象，这样子类原型对象就会被垃圾回收机制回收。</p>
<h3 id="2-如果浏览器不支持Object-create()方法怎么办？">2.如果浏览器不支持<code>Object.create()</code>方法怎么办？</h3><p>用一个只有三行的函数来替代<code>Object.create()</code>:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createobject</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    F.prototype = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用时替换代码的第18行：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Car.prototype = createobject(Vehicle.prototype);</span><br></pre></td></tr></table></figure></p>
<p>但是如果用这样的函数的话，就会污染全局变量。根据<a href="http://javascript.crockford.com/prototypal.html" title="crockford的文章" target="_blank" rel="external">crockford的文章</a>提示，做出如下修改：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.begetObject = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    F.prototype = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Car.prototype = Vehicle.prototype.begetObject();</span><br></pre></td></tr></table></figure></p>
<p>如此同样可以达到继承的目的，但是拓展原生对象是很危险的，如果Object.prototype.begetObject被覆盖，则会产生更大的危险。所以再引入下面的改进：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Object</span>.create !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="built_in">Object</span>.create = <span class="function"><span class="keyword">function</span> (<span class="params">o</span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">        F.prototype = o;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">Car.prototype = <span class="built_in">Object</span>.create(Vehicle.prototype);</span><br></pre></td></tr></table></figure></p>
<p>这样就类似于MDN上很多的Polyfill，先判断原生是否存在，如果不存在，就补全它。</p>
<h3 id="3-为什么需要在子类的函数体中call父类？">3.为什么需要在子类的函数体中call父类？</h3><p>如果在子类中没有调用父类构造器<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vehicle.call(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>那么调用子类对象的时候，访问父类的变量，将会弹出<code>undefined</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var ford = new Car()</span><br><span class="line">ford.wheel</span><br><span class="line">→ undefined</span><br></pre></td></tr></table></figure>
            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">標籤</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/JS/">JS</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/07/29/20150729-emacs-hydra/"  data-tooltip="使用hydra简化emacs窗口操作">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/07/07/20150707-css-experiment/" data-tooltip="CSS 小实验">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Taxus. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/07/29/20150729-emacs-hydra/"  data-tooltip="使用hydra简化emacs窗口操作">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/07/07/20150707-css-experiment/" data-tooltip="CSS 小实验">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-google-plus"></i><span class="">分享到 Google+</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-facebook-official"></i><span>分享到 Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/07/16/20150716-js-inherit/">
                <i class="fa fa-twitter"></i><span>分享到 Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Taxus</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    



</html>
